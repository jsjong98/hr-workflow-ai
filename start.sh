#!/bin/bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  HR Workflow Builder â€” ì›í´ë¦­ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ (Mac / Linux)
#  PwC Â· ë‘ì‚° HR AX
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ìŠ¤í¬ë¦½íŠ¸ê°€ ìˆëŠ” ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd "$(dirname "$0")"

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  ğŸ“‹ HR Workflow Builder ì‹¤í–‰ ì¤€ë¹„ ì¤‘..."
echo "  PwC Â· ë‘ì‚° HR AX"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# â”€â”€ 0. Gmail ì•ˆì „ íŒ¨í‚¤ì§• ë³µì› (.mjs.txt â†’ .mjs) â”€â”€
for f in *.mjs.txt; do
    [ -e "$f" ] || continue
    target="${f%.txt}"
    mv "$f" "$target"
    echo "ğŸ”§ ë³µì›: $f â†’ $target"
done

# â”€â”€ 1. Node.js ì„¤ì¹˜ í™•ì¸ â”€â”€
if ! command -v node &> /dev/null; then
    echo "âŒ Node.jsê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤."
    echo ""
    echo "ì•„ë˜ ë§í¬ì—ì„œ Node.js LTSë¥¼ ì„¤ì¹˜í•´ì£¼ì„¸ìš”:"
    echo "ğŸ‘‰ https://nodejs.org/ko"
    echo ""
    echo "ì„¤ì¹˜ í›„ ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ì„¸ìš”."
    read -p "ì•„ë¬´ í‚¤ë‚˜ ëˆ„ë¥´ì„¸ìš”..."
    exit 1
fi

NODE_VER=$(node -v)
echo "âœ… Node.js í™•ì¸: $NODE_VER"

# â”€â”€ 2. .env.local íŒŒì¼ í™•ì¸ (OpenAI API Key) â”€â”€
if [ ! -f ".env.local" ]; then
    echo ""
    echo "âš ï¸  .env.local íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤."
    echo "   AI ì›Œí¬í”Œë¡œìš° ìƒì„± ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ OpenAI API Keyê°€ í•„ìš”í•©ë‹ˆë‹¤."
    echo ""
    read -p "OpenAI API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì—†ìœ¼ë©´ Enterë¡œ ê±´ë„ˆë›°ê¸°): " API_KEY
    if [ -n "$API_KEY" ]; then
        echo "OPENAI_API_KEY=\"$API_KEY\"" > .env.local
        echo "âœ… .env.local íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤."
    else
        echo "â© API Key ì—†ì´ ì§„í–‰í•©ë‹ˆë‹¤. (AI ê¸°ëŠ¥ì€ ì‚¬ìš© ë¶ˆê°€)"
        echo "OPENAI_API_KEY=\"\"" > .env.local
    fi
else
    echo "âœ… .env.local í™•ì¸ ì™„ë£Œ"
fi

# â”€â”€ 3. íŒ¨í‚¤ì§€ ì„¤ì¹˜ â”€â”€
if [ ! -d "node_modules" ]; then
    echo ""
    echo "ğŸ“¦ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì¤‘... (ìµœì´ˆ 1íšŒ, 2~3ë¶„ ì†Œìš”)"
    npm install --legacy-peer-deps
    if [ $? -ne 0 ]; then
        echo "âŒ íŒ¨í‚¤ì§€ ì„¤ì¹˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
        read -p "ì•„ë¬´ í‚¤ë‚˜ ëˆ„ë¥´ì„¸ìš”..."
        exit 1
    fi
    echo "âœ… íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì™„ë£Œ"
else
    echo "âœ… íŒ¨í‚¤ì§€ ì´ë¯¸ ì„¤ì¹˜ë¨"
fi

# â”€â”€ 4. ì„œë²„ ì‹¤í–‰ â”€â”€
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  ğŸš€ ì„œë²„ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
echo "  ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:3000 ìœ¼ë¡œ ì ‘ì†í•˜ì„¸ìš”"
echo "  ì¢…ë£Œí•˜ë ¤ë©´ Ctrl+C ë¥¼ ëˆ„ë¥´ì„¸ìš”"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# ë¸Œë¼ìš°ì € ìë™ ì—´ê¸° (2ì´ˆ í›„)
(sleep 2 && open "http://localhost:3000" 2>/dev/null || xdg-open "http://localhost:3000" 2>/dev/null) &

npm run dev
